generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tool {
  id         String         @id // Кастомный ID из JSON
  type       String
  status     ToolStatus     @default(draft)
  engine     ToolEngine     @default(json)
  created_at DateTime       @default(now())
  updated_at DateTime       @updatedAt
  categories ToolCategory[]
  config     ToolConfig?
  i18n       ToolI18n[]

  @@map("tools")
}

model ToolI18n {
  id                  Int       @id @default(autoincrement())
  tool_id             String
  lang                String
  slug                String
  title               String
  h1                  String?
  meta_title          String?
  meta_description    String?
  meta_robots         String?   @default("index,follow")
  canonical_path      String?
  short_answer        String?
  intro_text          String?
  key_points_json     Json?
  inputs_json         Json?
  outputs_json        Json?
  examples_json       Json?
  formula_md          String?
  assumptions_md      String?
  faq_json            Json?
  howto_json          Json?
  content_blocks_json Json?
  schema_json         Json?
  og_title            String?
  og_description      String?
  og_image_url        String?
  twitter_title       String?
  twitter_description String?
  twitter_image_url   String?
  is_popular          Int       @default(0)
  last_reviewed_at    DateTime?
  updated_at          DateTime  @updatedAt
  tool                Tool      @relation(fields: [tool_id], references: [id], onDelete: Cascade)

  @@unique([lang, slug])
  @@unique([tool_id, lang])
  @@map("tool_i18n")
}

model ToolConfig {
  tool_id              String  @id
  config_json          Json
  custom_component_key String?
  tool                 Tool    @relation(fields: [tool_id], references: [id], onDelete: Cascade)

  @@map("tool_config")
}

model Category {
  id         String         @id @default(uuid())
  parent_id  String?
  sort_order Int            @default(0)
  parent     Category?      @relation("CategoryHierarchy", fields: [parent_id], references: [id])
  children   Category[]     @relation("CategoryHierarchy")
  i18n       CategoryI18n[]
  tools      ToolCategory[]

  @@map("categories")
}

model CategoryI18n {
  category_id         String
  lang                String
  slug                String
  name                String
  meta_title          String?
  meta_description    String?
  short_description   String?
  intro_text          String?
  og_title            String?
  og_description      String?
  og_image_url        String?
  content_blocks_json Json?
  og_image_alt        String?
  is_popular          Int      @default(0)
  category            Category @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@unique([category_id, lang])
  @@unique([lang, slug])
  @@map("category_i18n")
}

model ToolCategory {
  tool_id     String
  category_id String
  category    Category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  tool        Tool     @relation(fields: [tool_id], references: [id], onDelete: Cascade)

  @@id([tool_id, category_id])
  @@map("tool_categories")
}

model Page {
  id         String     @id @default(uuid())
  code       String     @unique
  status     PageStatus @default(draft)
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  i18n       PageI18n[]

  @@map("pages")
}

model PageI18n {
  page_id          String
  lang             String
  slug             String
  meta_title       String?
  meta_description String?
  meta_robots      String?
  h1               String
  short_answer     String?
  body_blocks_json Json?
  schema_json      Json?
  updated_at       DateTime  @updatedAt
  last_reviewed_at DateTime?
  page             Page      @relation(fields: [page_id], references: [id], onDelete: Cascade)

  @@unique([page_id, lang])
  @@unique([lang, slug])
  @@map("page_i18n")
}

enum ToolStatus {
  draft
  published
  archived
}

enum ToolEngine {
  json
  custom
}

enum PageStatus {
  draft
  published
}
